import telebot
import sqlite3
import time
import random
import os
from datetime import datetime, timedelta
from flask import Flask, request, abort
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger
import pytz

# توكن البوت الخاص بك
BOT_TOKEN = os.environ.get('BOT_TOKEN')
if not BOT_TOKEN:
    raise ValueError("BOT_TOKEN environment variable is required. Please set it before running the bot.")
    
bot = telebot.TeleBot(BOT_TOKEN)
app = Flask(__name__)

# المنطقة الزمنية (توقيت مكة المكرمة)
TIMEZONE = pytz.timezone('Asia/Riyadh')

# قاعدة بيانات لتخزين إعدادات المجموعات
conn = sqlite3.connect('azkar_bot.db', check_same_thread=False)
cursor = conn.cursor()

# إنشاء جداول قاعدة البيانات
cursor.execute('''CREATE TABLE IF NOT EXISTS chat_settings
                  (chat_id INTEGER PRIMARY KEY,
                   is_admin INTEGER DEFAULT 0,
                   morning_azkar INTEGER DEFAULT 1,
                   evening_azkar INTEGER DEFAULT 1,
                   friday_sura INTEGER DEFAULT 1,
                   friday_dua INTEGER DEFAULT 1,
                   sleep_image INTEGER DEFAULT 1,
                   random_content INTEGER DEFAULT 1,
                   content_interval INTEGER DEFAULT 180,
                   morning_time TEXT DEFAULT '05:00',
                   evening_time TEXT DEFAULT '18:00',
                   sleep_time TEXT DEFAULT '22:00',
                   content_types TEXT DEFAULT 'text,image,audio,pdf')''')

cursor.execute('''CREATE TABLE IF NOT EXISTS admin_users
                  (chat_id INTEGER, user_id INTEGER,
                   PRIMARY KEY (chat_id, user_id))''')

conn.commit()

# محتوى الأذكار والأدعية
MORNING_AZKAR = [
    """🌅 أذكار الصباح 🌅

﴿ اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۚ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ ۚ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ ۗ مَن ذَا الَّذِي يَشْفَعُ عِندَهُ إِلَّا بِإِذْنِهِ ۚ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۖ وَلَا يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلَّا بِمَا شَاءَ ۚ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ ۖ وَلَا يَئُودُهُ حِفْظُهُمَا ۚ وَهُوَ الْعَلِيُّ الْعَظِيمُ ﴾

📿 آية الكرسي (مرة واحدة)""",
    
    """☀️ أذكار الصباح ☀️

أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ.

رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذَا الْيَوْمِ وَخَيْرَ مَا بَعْدَهُ، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذَا الْيَوْمِ وَشَرِّ مَا بَعْدَهُ.

🌟 (مرة واحدة)""",
    
    """🌄 أذكار الصباح 🌄

اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ.

سُبْحَانَ اللَّهِ وَبِحَمْدِهِ عَدَدَ خَلْقِهِ وَرِضَا نَفْسِهِ وَزِنَةَ عَرْشِهِ وَمِدَادَ كَلِمَاتِهِ.

💫 (ثلاث مرات)""",
    
    """🌅 أذكار الصباح 🌅

اللَّهُمَّ إِنِّي أَصْبَحْتُ أُشْهِدُكَ، وَأُشْهِدُ حَمَلَةَ عَرْشِكَ، وَمَلَائِكَتَكَ، وَجَمِيعَ خَلْقِكَ، أَنَّكَ أَنْتَ اللَّهُ لَا إِلَهَ إِلَّا أَنْتَ وَحْدَكَ لَا شَرِيكَ لَكَ، وَأَنَّ مُحَمَّدًا عَبْدُكَ وَرَسُولُكَ.

✨ (أربع مرات)""",
    
    """☀️ أذكار الصباح ☀️

اللَّهُمَّ مَا أَصْبَحَ بِي مِنْ نِعْمَةٍ أَوْ بِأَحَدٍ مِنْ خَلْقِكَ فَمِنْكَ وَحْدَكَ لَا شَرِيكَ لَكَ، فَلَكَ الْحَمْدُ وَلَكَ الشُّكْرُ.

🙏 (مرة واحدة)""",
    
    """🌄 أذكار الصباح 🌄

اللَّهُمَّ عَافِنِي فِي بَدَنِي، اللَّهُمَّ عَافِنِي فِي سَمْعِي، اللَّهُمَّ عَافِنِي فِي بَصَرِي، لَا إِلَهَ إِلَّا أَنْتَ.

اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْكُفْرِ، وَالْفَقْرِ، وَأَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ، لَا إِلَهَ إِلَّا أَنْتَ.

🛡️ (ثلاث مرات)""",
    
    """🌅 أذكار الصباح 🌅

حَسْبِيَ اللَّهُ لَا إِلَهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ.

💪 (سبع مرات)""",
    
    """☀️ أذكار الصباح ☀️

اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنَ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنَ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ وَقَهْرِ الرِّجَالِ.

🤲 (مرة واحدة)""",
    
    """🌄 أذكار الصباح 🌄

أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ.

🌟 (ثلاث مرات)""",
    
    """🌅 أذكار الصباح 🌅

اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي الدُّنْيَا وَالْآخِرَةِ، اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي دِينِي وَدُنْيَايَ وَأَهْلِي وَمَالِي.

اللَّهُمَّ اسْتُرْ عَوْرَاتِي، وَآمِنْ رَوْعَاتِي، اللَّهُمَّ احْفَظْنِي مِنْ بَيْنِ يَدَيَّ، وَمِنْ خَلْفِي، وَعَنْ يَمِينِي، وَعَنْ شِمَالِي، وَمِنْ فَوْقِي، وَأَعُوذُ بِعَظَمَتِكَ أَنْ أُغْتَالَ مِنْ تَحْتِي.

💚 (مرة واحدة)""",
    
    """☀️ أذكار الصباح ☀️

يَا حَيُّ يَا قَيُّومُ بِرَحْمَتِكَ أَسْتَغِيثُ، أَصْلِحْ لِي شَأْنِي كُلَّهُ، وَلَا تَكِلْنِي إِلَى نَفْسِي طَرْفَةَ عَيْنٍ.

✨ (مرة واحدة)""",
    
    """🌄 أذكار الصباح 🌄

لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ.

🌟 (مائة مرة - من قالها كتبت له عدل عشر رقاب)""",
    
    """🌅 أذكار الصباح 🌅

﴿ قُلْ هُوَ اللَّهُ أَحَدٌ * اللَّهُ الصَّمَدُ * لَمْ يَلِدْ وَلَمْ يُولَدْ * وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ ﴾

﴿ قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ * مِن شَرِّ مَا خَلَقَ * وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ * وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ * وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ ﴾

﴿ قُلْ أَعُوذُ بِرَبِّ النَّاسِ * مَلِكِ النَّاسِ * إِلَٰهِ النَّاسِ * مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ * الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ * مِنَ الْجِنَّةِ وَالنَّاسِ ﴾

📿 المعوذات (ثلاث مرات)"""
]

EVENING_AZKAR = [
    """🌙 أذكار المساء 🌙

﴿ اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۚ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ ۚ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ ۗ مَن ذَا الَّذِي يَشْفَعُ عِندَهُ إِلَّا بِإِذْنِهِ ۚ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۖ وَلَا يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلَّا بِمَا شَاءَ ۚ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ ۖ وَلَا يَئُودُهُ حِفْظُهُمَا ۚ وَهُوَ الْعَلِيُّ الْعَظِيمُ ﴾

📿 آية الكرسي (مرة واحدة)""",
    
    """🌆 أذكار المساء 🌆

أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ.

رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذِهِ اللَّيْلَةِ وَخَيْرَ مَا بَعْدَهَا، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذِهِ اللَّيْلَةِ وَشَرِّ مَا بَعْدَهَا.

🌟 (مرة واحدة)""",
    
    """🌃 أذكار المساء 🌃

اللَّهُمَّ بِكَ أَمْسَيْنَا، وَبِكَ أَصْبَحْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ الْمَصِيرُ.

أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ.

🛡️ (ثلاث مرات)""",
    
    """🌙 أذكار المساء 🌙

اللَّهُمَّ إِنِّي أَمْسَيْتُ أُشْهِدُكَ، وَأُشْهِدُ حَمَلَةَ عَرْشِكَ، وَمَلَائِكَتَكَ، وَجَمِيعَ خَلْقِكَ، أَنَّكَ أَنْتَ اللَّهُ لَا إِلَهَ إِلَّا أَنْتَ وَحْدَكَ لَا شَرِيكَ لَكَ، وَأَنَّ مُحَمَّدًا عَبْدُكَ وَرَسُولُكَ.

✨ (أربع مرات)""",
    
    """🌆 أذكار المساء 🌆

اللَّهُمَّ مَا أَمْسَى بِي مِنْ نِعْمَةٍ أَوْ بِأَحَدٍ مِنْ خَلْقِكَ فَمِنْكَ وَحْدَكَ لَا شَرِيكَ لَكَ، فَلَكَ الْحَمْدُ وَلَكَ الشُّكْرُ.

🙏 (مرة واحدة)""",
    
    """🌃 أذكار المساء 🌃

اللَّهُمَّ عَافِنِي فِي بَدَنِي، اللَّهُمَّ عَافِنِي فِي سَمْعِي، اللَّهُمَّ عَافِنِي فِي بَصَرِي، لَا إِلَهَ إِلَّا أَنْتَ.

اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْكُفْرِ، وَالْفَقْرِ، وَأَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ، لَا إِلَهَ إِلَّا أَنْتَ.

🛡️ (ثلاث مرات)""",
    
    """🌙 أذكار المساء 🌙

حَسْبِيَ اللَّهُ لَا إِلَهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ.

💪 (سبع مرات)""",
    
    """🌆 أذكار المساء 🌆

اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنَ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنَ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ وَقَهْرِ الرِّجَالِ.

🤲 (مرة واحدة)""",
    
    """🌃 أذكار المساء 🌃

اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي الدُّنْيَا وَالْآخِرَةِ، اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي دِينِي وَدُنْيَايَ وَأَهْلِي وَمَالِي.

اللَّهُمَّ اسْتُرْ عَوْرَاتِي، وَآمِنْ رَوْعَاتِي، اللَّهُمَّ احْفَظْنِي مِنْ بَيْنِ يَدَيَّ، وَمِنْ خَلْفِي، وَعَنْ يَمِينِي، وَعَنْ شِمَالِي، وَمِنْ فَوْقِي، وَأَعُوذُ بِعَظَمَتِكَ أَنْ أُغْتَالَ مِنْ تَحْتِي.

💚 (مرة واحدة)""",
    
    """🌙 أذكار المساء 🌙

يَا حَيُّ يَا قَيُّومُ بِرَحْمَتِكَ أَسْتَغِيثُ، أَصْلِحْ لِي شَأْنِي كُلَّهُ، وَلَا تَكِلْنِي إِلَى نَفْسِي طَرْفَةَ عَيْنٍ.

✨ (مرة واحدة)""",
    
    """🌆 أذكار المساء 🌆

لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ.

🌟 (مائة مرة - من قالها كتبت له عدل عشر رقاب)""",
    
    """🌃 أذكار المساء 🌃

﴿ قُلْ هُوَ اللَّهُ أَحَدٌ * اللَّهُ الصَّمَدُ * لَمْ يَلِدْ وَلَمْ يُولَدْ * وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ ﴾

﴿ قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ * مِن شَرِّ مَا خَلَقَ * وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ * وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ * وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ ﴾

﴿ قُلْ أَعُوذُ بِرَبِّ النَّاسِ * مَلِكِ النَّاسِ * إِلَٰهِ النَّاسِ * مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ * الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ * مِنَ الْجِنَّةِ وَالنَّاسِ ﴾

📿 المعوذات (ثلاث مرات)"""
]

RANDOM_DUAS = [
    "🤲 رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ 🤲",
    "💚 اللَّهُمَّ إِنِّي أَسْأَلُكَ الْهُدَى وَالتُّقَى، وَالْعَفَافَ وَالْغِنَى 💚",
    "✨ رَبِّ اشْرَحْ لِي صَدْرِي، وَيَسِّرْ لِي أَمْرِي، وَاحْلُلْ عُقْدَةً مِّن لِّسَانِي، يَفْقَهُوا قَوْلِي ✨",
    "🌟 اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنَ الْعَجْزِ وَالْكَسَلِ 🌟",
    "🕊️ رَبَّنَا لَا تُؤَاخِذْنَا إِن نَّسِينَا أَوْ أَخْطَأْنَا، رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَا إِصْرًا كَمَا حَمَلْتَهُ عَلَى الَّذِينَ مِن قَبْلِنَا 🕊️",
    "💎 اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا 💎",
    "🌺 اللَّهُمَّ أَصْلِحْ لِي دِينِي الَّذِي هُوَ عِصْمَةُ أَمْرِي، وَأَصْلِحْ لِي دُنْيَايَ الَّتِي فِيهَا مَعَاشِي 🌺",
    "☘️ رَبِّ أَوْزِعْنِي أَنْ أَشْكُرَ نِعْمَتَكَ الَّتِي أَنْعَمْتَ عَلَيَّ وَعَلَىٰ وَالِدَيَّ وَأَنْ أَعْمَلَ صَالِحًا تَرْضَاهُ ☘️",
    "🌸 اللَّهُمَّ إِنَّكَ عَفُوٌّ كَرِيمٌ تُحِبُّ الْعَفْوَ فَاعْفُ عَنِّي 🌸",
    "🌿 اللَّهُمَّ اغْفِرْ لِي ذَنْبِي كُلَّهُ، دِقَّهُ وَجِلَّهُ، وَأَوَّلَهُ وَآخِرَهُ، وَعَلَانِيَتَهُ وَسِرَّهُ 🌿",
    "🌼 رَبَّنَا اغْفِرْ لَنَا وَلِإِخْوَانِنَا الَّذِينَ سَبَقُونَا بِالْإِيمَانِ وَلَا تَجْعَلْ فِي قُلُوبِنَا غِلًّا لِّلَّذِينَ آمَنُوا 🌼",
    "💫 رَبِّ اجْعَلْنِي مُقِيمَ الصَّلَاةِ وَمِن ذُرِّيَّتِي رَبَّنَا وَتَقَبَّلْ دُعَاءِ 💫",
    "🌷 اللَّهُمَّ إِنِّي أَسْأَلُكَ الْجَنَّةَ وَأَعُوذُ بِكَ مِنَ النَّارِ 🌷",
    "🍃 اللَّهُمَّ آتِ نَفْسِي تَقْوَاهَا، وَزَكِّهَا أَنتَ خَيْرُ مَن زَكَّاهَا، أَنتَ وَلِيُّهَا وَمَوْلَاهَا 🍃",
    "🌹 رَبَّنَا هَبْ لَنَا مِنْ أَزْوَاجِنَا وَذُرِّيَّاتِنَا قُرَّةَ أَعْيُنٍ وَاجْعَلْنَا لِلْمُتَّقِينَ إِمَامًا 🌹",
    "⭐ اللَّهُمَّ إِنِّي أَسْأَلُكَ فِعْلَ الْخَيْرَاتِ، وَتَرْكَ الْمُنكَرَاتِ، وَحُبَّ الْمَسَاكِينِ ⭐",
    "🌟 اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ زَوَالِ نِعْمَتِكَ، وَتَحَوُّلِ عَافِيَتِكَ، وَفُجَاءَةِ نِقْمَتِكَ، وَجَمِيعِ سَخَطِكَ 🌟",
    "🌺 اللَّهُمَّ أَلِّفْ بَيْنَ قُلُوبِنَا، وَأَصْلِحْ ذَاتَ بَيْنِنَا، وَاهْدِنَا سُبُلَ السَّلَامِ 🌺",
    "💐 اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ شَرِّ مَا عَمِلْتُ، وَمِنْ شَرِّ مَا لَمْ أَعْمَلْ 💐",
    "🕌 اللَّهُمَّ اجْعَلْنِي شَكُورًا، وَاجْعَلْنِي صَبُورًا، وَاجْعَلْنِي فِي عَيْنِي صَغِيرًا، وَفِي أَعْيُنِ النَّاسِ كَبِيرًا 🕌",
    "🌙 رَبِّ أَدْخِلْنِي مُدْخَلَ صِدْقٍ وَأَخْرِجْنِي مُخْرَجَ صِدْقٍ وَاجْعَل لِّي مِن لَّدُنكَ سُلْطَانًا نَّصِيرًا 🌙",
    "✨ اللَّهُمَّ اكْفِنِي بِحَلَالِكَ عَنْ حَرَامِكَ، وَأَغْنِنِي بِفَضْلِكَ عَمَّنْ سِوَاكَ ✨",
    "🌟 رَبَّنَا اغْفِرْ لَنَا ذُنُوبَنَا وَإِسْرَافَنَا فِي أَمْرِنَا وَثَبِّتْ أَقْدَامَنَا وَانصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ 🌟",
    "🌸 اللَّهُمَّ إِنِّي أَسْأَلُكَ الثَّبَاتَ فِي الْأَمْرِ، وَالْعَزِيمَةَ عَلَى الرُّشْدِ 🌸",
    "🍀 اللَّهُمَّ مُصَرِّفَ الْقُلُوبِ صَرِّفْ قُلُوبَنَا عَلَى طَاعَتِكَ 🍀",
    "💚 رَبَّنَا لَا تُزِغْ قُلُوبَنَا بَعْدَ إِذْ هَدَيْتَنَا وَهَبْ لَنَا مِن لَّدُنكَ رَحْمَةً إِنَّكَ أَنتَ الْوَهَّابُ 💚",
    "🌺 اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنَ الْخَيْرِ كُلِّهِ عَاجِلِهِ وَآجِلِهِ، مَا عَلِمْتُ مِنْهُ وَمَا لَمْ أَعْلَمْ 🌺",
    "🌷 رَبِّ ارْحَمْهُمَا كَمَا رَبَّيَانِي صَغِيرًا 🌷",
    "💫 اللَّهُمَّ اهْدِنِي وَسَدِّدْنِي 💫",
    "🌹 اللَّهُمَّ طَهِّرْنِي مِنَ الذُّنُوبِ وَالْخَطَايَا 🌹",
    "🌿 رَبَّنَا وَآتِنَا مَا وَعَدتَّنَا عَلَىٰ رُسُلِكَ وَلَا تُخْزِنَا يَوْمَ الْقِيَامَةِ إِنَّكَ لَا تُخْلِفُ الْمِيعَادَ 🌿",
    "🌼 اللَّهُمَّ اجْعَلْ أَوْسَعَ رِزْقِكَ عَلَيَّ عِنْدَ كِبَرِ سِنِّي وَانْقِطَاعِ عُمُرِي 🌼",
    "⭐ اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عِلْمٍ لَا يَنْفَعُ، وَمِنْ قَلْبٍ لَا يَخْشَعُ، وَمِنْ نَفْسٍ لَا تَشْبَعُ، وَمِنْ دَعْوَةٍ لَا يُسْتَجَابُ لَهَا ⭐",
    "🌸 اللَّهُمَّ بَارِكْ لَنَا فِي رَجَبٍ وَشَعْبَانَ وَبَلِّغْنَا رَمَضَانَ 🌸",
    "💐 اللَّهُمَّ إِنِّي أَسْأَلُكَ حُبَّكَ وَحُبَّ مَنْ يُحِبُّكَ وَحُبَّ عَمَلٍ يُقَرِّبُنِي إِلَى حُبِّكَ 💐",
    "🌟 رَبِّ زِدْنِي عِلْمًا 🌟",
    "🌺 اللَّهُمَّ إِنِّي أَسْأَلُكَ خَيْرَ الْمَسْأَلَةِ، وَخَيْرَ الدُّعَاءِ، وَخَيْرَ النَّجَاحِ 🌺",
    "🍃 اللَّهُمَّ ارْزُقْنِي حُسْنَ الْخَاتِمَةِ 🍃",
    "🌷 رَبَّنَا آمَنَّا فَاغْفِرْ لَنَا وَارْحَمْنَا وَأَنتَ خَيْرُ الرَّاحِمِينَ 🌷",
    "💫 اللَّهُمَّ لَا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الْحَزْنَ إِذَا شِئْتَ سَهْلًا 💫",
    "🌹 اللَّهُمَّ إِنِّي أَسْأَلُكَ يَا اللَّهُ بِأَنَّكَ الْوَاحِدُ الْأَحَدُ الصَّمَدُ الَّذِي لَمْ يَلِدْ وَلَمْ يُولَدْ وَلَمْ يَكُنْ لَهُ كُفُوًا أَحَدٌ، أَنْ تَغْفِرَ لِي ذُنُوبِي إِنَّكَ أَنْتَ الْغَفُورُ الرَّحِيمُ 🌹",
    "🌿 اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَافِيَةَ فِي الدُّنْيَا وَالْآخِرَةِ 🌿",
    "🌼 رَبَّنَا تَقَبَّلْ مِنَّا إِنَّكَ أَنتَ السَّمِيعُ الْعَلِيمُ 🌼"
]

QURAN_VERSES = [
    "📖 ﴿ فَاذْكُرُونِي أَذْكُرْكُمْ وَاشْكُرُوا لِي وَلَا تَكْفُرُونِ ﴾\n[البقرة: 152]",
    "📖 ﴿ وَقَالَ رَبُّكُمُ ادْعُونِي أَسْتَجِبْ لَكُمْ ﴾\n[غافر: 60]",
    "📖 ﴿ إِنَّ مَعَ الْعُسْرِ يُسْرًا ﴾\n[الشرح: 6]",
    "📖 ﴿ وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا * وَيَرْزُقْهُ مِنْ حَيْثُ لَا يَحْتَسِبُ ﴾\n[الطلاق: 2-3]",
    "📖 ﴿ فَإِنَّ مَعَ الْعُسْرِ يُسْرًا * إِنَّ مَعَ الْعُسْرِ يُسْرًا ﴾\n[الشرح: 5-6]",
    "📖 ﴿ وَلَذِكْرُ اللَّهِ أَكْبَرُ ﴾\n[العنكبوت: 45]",
    "📖 ﴿ يَا أَيُّهَا الَّذِينَ آمَنُوا اذْكُرُوا اللَّهَ ذِكْرًا كَثِيرًا ﴾\n[الأحزاب: 41]",
    "📖 ﴿ أَلَا بِذِكْرِ اللَّهِ تَطْمَئِنُّ الْقُلُوبُ ﴾\n[الرعد: 28]",
    "📖 ﴿ وَاسْتَعِينُوا بِالصَّبْرِ وَالصَّلَاةِ وَإِنَّهَا لَكَبِيرَةٌ إِلَّا عَلَى الْخَاشِعِينَ ﴾\n[البقرة: 45]",
    "📖 ﴿ إِنَّ اللَّهَ مَعَ الصَّابِرِينَ ﴾\n[البقرة: 153]",
    "📖 ﴿ وَبَشِّرِ الصَّابِرِينَ * الَّذِينَ إِذَا أَصَابَتْهُم مُّصِيبَةٌ قَالُوا إِنَّا لِلَّهِ وَإِنَّا إِلَيْهِ رَاجِعُونَ ﴾\n[البقرة: 155-156]",
    "📖 ﴿ إِنَّ اللَّهَ لَا يُغَيِّرُ مَا بِقَوْمٍ حَتَّىٰ يُغَيِّرُوا مَا بِأَنفُسِهِمْ ﴾\n[الرعد: 11]",
    "📖 ﴿ وَمَا تَوْفِيقِي إِلَّا بِاللَّهِ عَلَيْهِ تَوَكَّلْتُ وَإِلَيْهِ أُنِيبُ ﴾\n[هود: 88]",
    "📖 ﴿ حَسْبُنَا اللَّهُ وَنِعْمَ الْوَكِيلُ ﴾\n[آل عمران: 173]",
    "📖 ﴿ وَمَن يَتَوَكَّلْ عَلَى اللَّهِ فَهُوَ حَسْبُهُ ﴾\n[الطلاق: 3]",
    "📖 ﴿ إِنَّ اللَّهَ يُحِبُّ الْمُتَوَكِّلِينَ ﴾\n[آل عمران: 159]",
    "📖 ﴿ وَهُوَ مَعَكُمْ أَيْنَ مَا كُنتُمْ ﴾\n[الحديد: 4]",
    "📖 ﴿ فَاصْبِرْ إِنَّ وَعْدَ اللَّهِ حَقٌّ ﴾\n[الروم: 60]",
    "📖 ﴿ إِنَّمَا يُوَفَّى الصَّابِرُونَ أَجْرَهُم بِغَيْرِ حِسَابٍ ﴾\n[الزمر: 10]",
    "📖 ﴿ وَأَنِ اسْتَغْفِرُوا رَبَّكُمْ ثُمَّ تُوبُوا إِلَيْهِ يُمَتِّعْكُم مَّتَاعًا حَسَنًا ﴾\n[هود: 3]",
    "📖 ﴿ وَتُوبُوا إِلَى اللَّهِ جَمِيعًا أَيُّهَ الْمُؤْمِنُونَ لَعَلَّكُمْ تُفْلِحُونَ ﴾\n[النور: 31]",
    "📖 ﴿ إِنَّ اللَّهَ يُحِبُّ التَّوَّابِينَ وَيُحِبُّ الْمُتَطَهِّرِينَ ﴾\n[البقرة: 222]",
    "📖 ﴿ قُل يَا عِبَادِيَ الَّذِينَ أَسْرَفُوا عَلَىٰ أَنفُسِهِمْ لَا تَقْنَطُوا مِن رَّحْمَةِ اللَّهِ ﴾\n[الزمر: 53]",
    "📖 ﴿ وَرَحْمَتِي وَسِعَتْ كُلَّ شَيْءٍ ﴾\n[الأعراف: 156]",
    "📖 ﴿ فَإِذَا فَرَغْتَ فَانصَبْ * وَإِلَىٰ رَبِّكَ فَارْغَب ﴾\n[الشرح: 7-8]",
    "📖 ﴿ إِنَّ الصَّلَاةَ تَنْهَىٰ عَنِ الْفَحْشَاءِ وَالْمُنكَرِ ﴾\n[العنكبوت: 45]",
    "📖 ﴿ وَاسْتَعِينُوا بِالصَّبْرِ وَالصَّلَاةِ ﴾\n[البقرة: 45]",
    "📖 ﴿ وَمَا خَلَقْتُ الْجِنَّ وَالْإِنسَ إِلَّا لِيَعْبُدُونِ ﴾\n[الذاريات: 56]",
    "📖 ﴿ قُلْ إِنَّ صَلَاتِي وَنُسُكِي وَمَحْيَايَ وَمَمَاتِي لِلَّهِ رَبِّ الْعَالَمِينَ ﴾\n[الأنعام: 162]",
    "📖 ﴿ مَّا يَفْعَلُ اللَّهُ بِعَذَابِكُمْ إِن شَكَرْتُمْ وَآمَنتُمْ ﴾\n[النساء: 147]",
    "📖 ﴿ لَئِن شَكَرْتُمْ لَأَزِيدَنَّكُمْ ﴾\n[إبراهيم: 7]",
    "📖 ﴿ وَمَا بِكُم مِّن نِّعْمَةٍ فَمِنَ اللَّهِ ﴾\n[النحل: 53]",
    "📖 ﴿ وَإِذْ تَأَذَّنَ رَبُّكُمْ لَئِن شَكَرْتُمْ لَأَزِيدَنَّكُمْ ﴾\n[إبراهيم: 7]",
    "📖 ﴿ إِنَّ الَّذِينَ قَالُوا رَبُّنَا اللَّهُ ثُمَّ اسْتَقَامُوا تَتَنَزَّلُ عَلَيْهِمُ الْمَلَائِكَةُ ﴾\n[فصلت: 30]",
    "📖 ﴿ وَاذْكُر رَّبَّكَ فِي نَفْسِكَ تَضَرُّعًا وَخِيفَةً ﴾\n[الأعراف: 205]",
    "📖 ﴿ وَاعْلَمُوا أَنَّ اللَّهَ يَحُولُ بَيْنَ الْمَرْءِ وَقَلْبِهِ ﴾\n[الأنفال: 24]",
    "📖 ﴿ وَأَقِيمُوا الصَّلَاةَ وَآتُوا الزَّكَاةَ وَأَطِيعُوا الرَّسُولَ لَعَلَّكُمْ تُرْحَمُونَ ﴾\n[النور: 56]",
    "📖 ﴿ إِنَّ الْحَسَنَاتِ يُذْهِبْنَ السَّيِّئَاتِ ﴾\n[هود: 114]",
    "📖 ﴿ وَمَا تُقَدِّمُوا لِأَنفُسِكُم مِّنْ خَيْرٍ تَجِدُوهُ عِندَ اللَّهِ ﴾\n[البقرة: 110]",
    "📖 ﴿ مَنْ عَمِلَ صَالِحًا مِّن ذَكَرٍ أَوْ أُنثَىٰ وَهُوَ مُؤْمِنٌ فَلَنُحْيِيَنَّهُ حَيَاةً طَيِّبَةً ﴾\n[النحل: 97]",
    "📖 ﴿ وَلَا تَهِنُوا وَلَا تَحْزَنُوا وَأَنتُمُ الْأَعْلَوْنَ إِن كُنتُم مُّؤْمِنِينَ ﴾\n[آل عمران: 139]",
    "📖 ﴿ إِنَّ اللَّهَ وَمَلَائِكَتَهُ يُصَلُّونَ عَلَى النَّبِيِّ ﴾\n[الأحزاب: 56]",
    "📖 ﴿ وَمَا أَرْسَلْنَاكَ إِلَّا رَحْمَةً لِّلْعَالَمِينَ ﴾\n[الأنبياء: 107]"
]

HADITH_TEXTS = [
    "🌸 قال رسول الله ﷺ:\n«مَن قال: سُبحانَ اللهِ وبِحَمْدِه، في يومٍ مِائةَ مَرَّةٍ، حُطَّتْ خَطاياه وإنْ كانَتْ مِثْلَ زَبَدِ البَحْرِ»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«كلمتان خفيفتان على اللسان، ثقيلتان في الميزان، حبيبتان إلى الرحمن: سبحان الله وبحمده، سبحان الله العظيم»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«مَن قال: لا إلهَ إلَّا اللهُ وحدَه لا شريكَ له، له المُلكُ وله الحمدُ، وهو على كلِّ شيءٍ قديرٌ، في يومٍ مائةَ مرَّةٍ، كانت له عَدلَ عشرِ رِقابٍ»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«الطُّهُورُ شَطْرُ الإيمانِ، والحَمْدُ لِلَّهِ تَمْلأُ المِيزانَ، وسُبْحانَ اللهِ والحَمْدُ لِلَّهِ تَملآنِ - أوْ تَمْلأُ - ما بيْنَ السَّمَواتِ والأرْضِ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«أحب الكلام إلى الله أربع: سبحان الله، والحمد لله، ولا إله إلا الله، والله أكبر»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«أَحَبُّ الأعمالِ إلى اللهِ أدومُها وإنْ قَلَّ»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«مَن صلَّى عليَّ صلاةً واحدةً صلَّى اللهُ عليه بها عشْرًا»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«الدُّعاءُ هو العبادةُ»\n[صحيح الترمذي]",
    "🌸 قال رسول الله ﷺ:\n«ما مِن عبدٍ مسلمٍ يَدعو اللهَ بدعوةٍ ليس فيها إثمٌ ولا قطيعةُ رَحِمٍ، إلَّا أعطاه اللهُ بها إحدى ثلاثٍ: إمَّا أنْ يُعجِّلَ له دعوتَه، وإمَّا أنْ يَدَّخِرَها له في الآخرةِ، وإمَّا أنْ يَصرِفَ عنه مِن السُّوءِ مِثلَها»\n[صحيح الترمذي]",
    "🌸 قال رسول الله ﷺ:\n«مَن قرأَ بالآيتينِ مِن آخرِ سورةِ البقرةِ في ليلةٍ كَفَتاهُ»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«مَن قرأَ آيةَ الكُرسيِّ دُبُرَ كلِّ صلاةٍ مكتوبةٍ، لم يمنَعْه مِن دخولِ الجنَّةِ إلَّا أنْ يموتَ»\n[صحيح النسائي]",
    "🌸 قال رسول الله ﷺ:\n«ألا أدُلُّكم على ما يمحو اللهُ به الخطايا، ويرفعُ به الدرجاتِ؟ إسباغُ الوضوءِ على المكارهِ، وكثرةُ الخُطا إلى المساجدِ، وانتظارُ الصلاةِ بعد الصلاةِ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«مَن صلَّى الصُّبحَ في جماعةٍ فهو في ذِمَّةِ اللهِ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«مَن غدا إلى المسجدِ أو راحَ أعدَّ اللهُ له نُزُلًا في الجنةِ كلَّما غدا أو راحَ»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«الصلواتُ الخمسُ، والجمعةُ إلى الجمعةِ، ورمضانُ إلى رمضانَ، مُكفِّراتٌ لِما بينهنَّ إذا اجتُنِبَتِ الكبائرُ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«مَن قامَ رمضانَ إيمانًا واحتسابًا، غُفِرَ له ما تقدَّمَ مِن ذنبِه»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«مَن صامَ رمضانَ إيمانًا واحتسابًا غُفِرَ له ما تقدَّمَ مِن ذنبِه»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«العُمرةُ إلى العُمرةِ كفَّارةٌ لِما بينهما، والحجُّ المبرورُ ليس له جزاءٌ إلَّا الجنةُ»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«مَن حجَّ فلم يرفُثْ ولم يفسُقْ رجَع كيومِ ولَدتْه أمُّه»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«صومُ يومِ عرفةَ أحتسِبُ على اللهِ أنْ يُكفِّرَ السَّنةَ الَّتي قبلَه، والسَّنةَ الَّتي بعدَه»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«مَا مِن أيَّامٍ العملُ الصَّالحُ فيها أحبُّ إلى اللهِ مِن هذه الأيَّامِ - يعني أيَّامَ العشرِ - قالوا: يا رسولَ اللهِ، ولا الجهادُ في سبيلِ اللهِ؟ قال: ولا الجهادُ في سبيلِ اللهِ، إلَّا رجلٌ خرَج بنفسِه ومالِه فلم يرجِعْ مِن ذلك بشيءٍ»\n[صحيح البخاري]",
    "🌸 قال رسول الله ﷺ:\n«تَسَحَّرُوا فإنَّ في السَّحُورِ بَرَكَةً»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«مَن فطَّرَ صائمًا كان له مِثلُ أجرِه، غيرَ أنَّه لا يَنقُصُ مِن أجرِ الصَّائمِ شيءٌ»\n[صحيح الترمذي]",
    "🌸 قال رسول الله ﷺ:\n«إنَّ للصائمِ عندَ فِطرِه دعوةً ما تُرَدُّ»\n[صحيح ابن ماجه]",
    "🌸 قال رسول الله ﷺ:\n«مَن قرأَ سورةَ الكَهفِ في يومِ الجُمُعةِ، أضاءَ له مِن النُّورِ ما بيْنَ الجُمُعتَيْنِ»\n[صحيح الحاكم]",
    "🌸 قال رسول الله ﷺ:\n«إنَّ في الجمعةِ ساعةً لا يوافقُها عبدٌ مسلمٌ يسألُ اللهَ فيها خيرًا إلَّا أعطاه إيَّاه»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«مَن اغتسَلَ يومَ الجُمُعةِ غُسلَ الجَنابةِ ثمَّ راحَ، فكأنَّما قرَّبَ بَدَنةً، ومَن راحَ في السَّاعةِ الثَّانيةِ، فكأنَّما قرَّبَ بقرةً»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«الكلمةُ الطيِّبةُ صدقةٌ»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«تبسُّمُكَ في وجهِ أخيكَ لكَ صدقةٌ»\n[صحيح الترمذي]",
    "🌸 قال رسول الله ﷺ:\n«اتَّقِ اللهَ حيثُما كنتَ، وأتْبِعِ السَّيِّئةَ الحسنةَ تمحُها، وخالِقِ النَّاسَ بخُلُقٍ حسَنٍ»\n[صحيح الترمذي]",
    "🌸 قال رسول الله ﷺ:\n«أكثرُ ما يُدخِلُ الناسَ الجنةَ تقوى اللهِ وحُسنُ الخُلُقِ»\n[صحيح الترمذي]",
    "🌸 قال رسول الله ﷺ:\n«إنَّ اللهَ طيِّبٌ لا يقبَلُ إلَّا طيِّبًا»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«المؤمِنُ القويُّ خيرٌ وأحبُّ إلى اللهِ مِن المؤمِنِ الضَّعيفِ، وفي كلٍّ خيرٌ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«احرِصْ على ما ينفعُك، واستعِنْ باللهِ ولا تعجِزْ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«إذا قال الرجلُ في المسجدِ: مَن يُجيبُني؟ فليَقُلْ: قُلِ الله يُجيبُكَ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«المسلمُ مَن سلِمَ المسلمونَ مِن لسانِه ويدِه»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«لا يؤمِنُ أحدُكم حتى يُحِبَّ لأخيه ما يُحِبُّ لنفسِه»\n[متفق عليه]",
    "🌸 قال رسول الله ﷺ:\n«الدِّينُ النَّصيحةُ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«مَن نفَّسَ عن مؤمنٍ كُربةً مِن كُرَبِ الدُّنيا، نفَّسَ اللهُ عنه كُربةً مِن كُرَبِ يومِ القيامةِ»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«واللهُ في عونِ العبدِ ما كان العبدُ في عونِ أخيه»\n[صحيح مسلم]",
    "🌸 قال رسول الله ﷺ:\n«مَن كان يؤمِنُ باللهِ واليومِ الآخِرِ فليَقُلْ خيرًا أو ليَصْمُتْ»\n[متفق عليه]"
]

FRIDAY_DUAS = [
    """🕌 أدعية يوم الجمعة 🕌

اللَّهُمَّ صَلِّ وَسَلِّمْ وَبَارِكْ عَلَى سَيِّدِنَا مُحَمَّدٍ وَعَلَى آلِهِ وَصَحْبِهِ أَجْمَعِينَ

عَدَدَ خَلْقِكَ وَرِضَا نَفْسِكَ وَزِنَةَ عَرْشِكَ وَمِدَادَ كَلِمَاتِكَ

🌟 أكثروا من الصلاة على النبي في هذا اليوم المبارك 🌟""",
    
    """🤲 دعاء يوم الجمعة 🤲

رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ

اللَّهُمَّ اجْعَلْ خَيْرَ أَعْمَالِنَا خَوَاتِمَهَا، وَخَيْرَ أَيَّامِنَا يَوْمَ لِقَائِكَ

💚 يوم الجمعة يوم عيد للمسلمين 💚""",
    
    """🕌 من فضائل يوم الجمعة 🕌

قال رسول الله ﷺ:
«خيرُ يومٍ طلعَتْ عليه الشَّمسُ يومُ الجُمُعةِ، فيه خُلِقَ آدمُ، وفيه أُدخِلَ الجنَّةَ، وفيه أُخرِجَ منها»

🌟 اللهم اجعلنا من المقبولين في هذا اليوم 🌟""",
    
    """🤲 دعاء الجمعة 🤲

اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ فَضْلِكَ وَرَحْمَتِكَ، فَإِنَّهُ لَا يَمْلِكُهَا إِلَّا أَنْتَ

رَبَّنَا تَقَبَّلْ مِنَّا إِنَّكَ أَنتَ السَّمِيعُ الْعَلِيمُ

💫 اللهم اجعلنا من عتقائك من النار 💫""",
    
    """🕌 ليلة الجمعة 🕌

اللَّهُمَّ اغْفِرْ لَنَا ذُنُوبَنَا وَكَفِّرْ عَنَّا سَيِّئَاتِنَا وَتَوَفَّنَا مَعَ الْأَبْرَارِ

اللَّهُمَّ آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً

✨ نسأل الله القبول والتوفيق ✨"""
]

# أدعية خاصة بيوم عرفة
ARAFAH_DUAS = [
    """⛰️ دعاء يوم عرفة ⛰️

قال رسول الله ﷺ:
«خيرُ الدُّعاءِ دُعاءُ يومِ عَرفةَ، وخيرُ ما قلتُ أنا والنَّبيُّونَ مِن قَبلي: لا إلهَ إلَّا اللهُ وحدَه لا شريكَ له، له المُلكُ وله الحمدُ وهو على كلِّ شيءٍ قديرٌ»

🤲 اللهم تقبل منا وأعتق رقابنا من النار 🤲""",
    
    """🕋 يوم عرفة 🕋

اللَّهُمَّ إِنِّي أَسْأَلُكَ الْجَنَّةَ وَمَا قَرَّبَ إِلَيْهَا مِنْ قَوْلٍ أَوْ عَمَلٍ، وَأَعُوذُ بِكَ مِنَ النَّارِ وَمَا قَرَّبَ إِلَيْهَا مِنْ قَوْلٍ أَوْ عَمَلٍ

💚 يوم عرفة يوم العتق من النار 💚""",
    
    """⛰️ فضل صيام عرفة ⛰️

قال رسول الله ﷺ:
«صومُ يومِ عرفةَ أحتسِبُ على اللهِ أنْ يُكفِّرَ السَّنةَ الَّتي قبلَه، والسَّنةَ الَّتي بعدَه»

✨ اللهم تقبل صيامنا ودعاءنا ✨"""
]

# أدعية رمضان
RAMADAN_DUAS = [
    """🌙 دعاء رمضان 🌙

اللَّهُمَّ إِنَّكَ عَفُوٌّ كَرِيمٌ تُحِبُّ الْعَفْوَ فَاعْفُ عَنِّي

اللَّهُمَّ بَلِّغْنَا لَيْلَةَ الْقَدْرِ وَاجْعَلْنَا مِنَ الْمَقْبُولِينَ

🌟 رمضان كريم 🌟""",
    
    """🌙 دعاء الإفطار 🌙

ذَهَبَ الظَّمَأُ وَابْتَلَّتِ الْعُرُوقُ وَثَبَتَ الْأَجْرُ إِنْ شَاءَ اللَّهُ

اللَّهُمَّ إِنِّي أَسْأَلُكَ بِرَحْمَتِكَ الَّتِي وَسِعَتْ كُلَّ شَيْءٍ أَنْ تَغْفِرَ لِي

🥤 تقبل الله صيامكم 🥤""",
    
    """🌙 دعاء السحور 🌙

اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ فَضْلِكَ

قال رسول الله ﷺ: «تَسَحَّرُوا فإنَّ في السَّحُورِ بَرَكَةً»

🍴 بارك الله لكم في السحور 🍴""",
    
    """🌙 ليلة القدر 🌙

﴿ لَيْلَةُ الْقَدْرِ خَيْرٌ مِّنْ أَلْفِ شَهْرٍ ﴾

اللَّهُمَّ إِنَّكَ عَفُوٌّ تُحِبُّ الْعَفْوَ فَاعْفُ عَنَّا

✨ اللهم بلغنا ليلة القدر وتقبل منا ✨""",
    
    """🌙 دعاء التراويح 🌙

اللَّهُمَّ اجْعَلْ فِي قَلْبِي نُورًا، وَفِي سَمْعِي نُورًا، وَفِي بَصَرِي نُورًا

رَبَّنَا تَقَبَّلْ مِنَّا إِنَّكَ أَنتَ السَّمِيعُ الْعَلِيمُ

🕌 تقبل الله قيامكم 🕌"""
]

# أدعية العيد
EID_DUAS = [
    """🎉 تكبيرات العيد 🎉

اللَّهُ أَكْبَرُ اللَّهُ أَكْبَرُ، لَا إِلَهَ إِلَّا اللَّهُ
اللَّهُ أَكْبَرُ اللَّهُ أَكْبَرُ، وَلِلَّهِ الْحَمْدُ

🌟 عيدكم مبارك وتقبل الله طاعتكم 🌟""",
    
    """🌙 دعاء العيد 🌙

اللَّهُمَّ تَقَبَّلْ مِنَّا صِيَامَنَا وَقِيَامَنَا وَرُكُوعَنَا وَسُجُودَنَا

اللَّهُمَّ اجْعَلْنَا مِنَ الْمَقْبُولِينَ

💚 كل عام وأنتم بخير 💚""",
    
    """🎊 عيد مبارك 🎊

اللَّهُمَّ اجْعَلْهُ عِيدَ خَيْرٍ وَبَرَكَةٍ

رَبَّنَا تَقَبَّلْ مِنَّا وَعَافِنَا وَاعْفُ عَنَّا

✨ تقبل الله منا ومنكم ✨"""
]

# أدعية العشر الأواخر
LAST_TEN_DAYS_DUAS = [
    """🌙 العشر الأواخر 🌙

اللَّهُمَّ إِنَّكَ عَفُوٌّ كَرِيمٌ تُحِبُّ الْعَفْوَ فَاعْفُ عَنَّا

قال رسول الله ﷺ: «تَحَرَّوْا ليلةَ القَدرِ في الوِترِ، مِنَ العَشرِ الأواخِرِ مِن رَمَضانَ»

✨ اللهم بلغنا ليلة القدر ✨""",
    
    """🌙 الاعتكاف 🌙

اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ، وَأَعُوذُ بِكَ مِنْ فِتْنَةِ الْمَسِيحِ الدَّجَّالِ، وَأَعُوذُ بِكَ مِنْ فِتْنَةِ الْمَحْيَا وَالْمَمَاتِ

🕌 اللهم تقبل اعتكافنا 🕌""",
    
    """🌙 قيام الليل 🌙

اللَّهُمَّ لَكَ الْحَمْدُ أَنْتَ نُورُ السَّمَاوَاتِ وَالْأَرْضِ، وَلَكَ الْحَمْدُ أَنْتَ قَيِّمُ السَّمَاوَاتِ وَالْأَرْضِ

💫 اللهم اجعلنا من القائمين ✨"""
]

SLEEP_MESSAGE = """🌙 قبل النوم 🌙

﴿ بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ * قُلْ هُوَ اللَّهُ أَحَدٌ * اللَّهُ الصَّمَدُ * لَمْ يَلِدْ وَلَمْ يُولَدْ * وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ ﴾

﴿ بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ * قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ * مِن شَرِّ مَا خَلَقَ * وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ * وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ * وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ ﴾

﴿ بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ * قُلْ أَعُوذُ بِرَبِّ النَّاسِ * مَلِكِ النَّاسِ * إِلَٰهِ النَّاسِ * مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ * الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ * مِنَ الْجِنَّةِ وَالنَّاسِ ﴾

اللَّهُمَّ بِاسْمِكَ أَمُوتُ وَأَحْيَا

😴 تصبحون على خير 😴"""

KAHF_MESSAGE = """📿 سورة الكهف 📿

🕌 يوم الجمعة المبارك 🕌

﴿ إِنَّ الَّذِينَ آمَنُوا وَعَمِلُوا الصَّالِحَاتِ إِنَّا لَا نُضِيعُ أَجْرَ مَنْ أَحْسَنَ عَمَلًا ﴾

قال رسول الله ﷺ:
«مَن قرأَ سورةَ الكَهفِ يومَ الجُمُعةِ أضاءَ له من النُّورِ ما بينَ الجُمُعتَينِ»

💡 اقرأوا سورة الكهف اليوم تنالوا الأجر والنور 💡

🔗 يمكنكم قراءتها من المصحف أو الاستماع إليها"""

# دوال مساعدة
def get_chat_settings(chat_id):
    """الحصول على إعدادات المجموعة"""
    cursor.execute('SELECT * FROM chat_settings WHERE chat_id = ?', (chat_id,))
    result = cursor.fetchone()
    if result:
        return {
            'chat_id': result[0],
            'is_admin': result[1],
            'morning_azkar': result[2],
            'evening_azkar': result[3],
            'friday_sura': result[4],
            'friday_dua': result[5],
            'sleep_image': result[6],
            'random_content': result[7],
            'content_interval': result[8],
            'morning_time': result[9],
            'evening_time': result[10],
            'sleep_time': result[11],
            'content_types': result[12]
        }
    else:
        # إنشاء إعدادات افتراضية
        cursor.execute('''INSERT INTO chat_settings (chat_id) VALUES (?)''', (chat_id,))
        conn.commit()
        return get_chat_settings(chat_id)

def is_user_admin(chat_id, user_id):
    """التحقق من أن المستخدم مشرف في المجموعة"""
    try:
        member = bot.get_chat_member(chat_id, user_id)
        return member.status in ['creator', 'administrator']
    except:
        return False

def send_azkar(chat_id, azkar_type):
    """إرسال الأذكار حسب النوع"""
    try:
        settings = get_chat_settings(chat_id)
        
        if azkar_type == 'morning' and settings['morning_azkar']:
            for azkar in MORNING_AZKAR:
                bot.send_message(chat_id, azkar, parse_mode='Markdown')
                time.sleep(2)
                
        elif azkar_type == 'evening' and settings['evening_azkar']:
            for azkar in EVENING_AZKAR:
                bot.send_message(chat_id, azkar, parse_mode='Markdown')
                time.sleep(2)
                
        elif azkar_type == 'sleep' and settings['sleep_image']:
            bot.send_message(chat_id, SLEEP_MESSAGE, parse_mode='Markdown')
            
        elif azkar_type == 'friday_kahf' and settings['friday_sura']:
            bot.send_message(chat_id, KAHF_MESSAGE, parse_mode='Markdown')
            
        elif azkar_type == 'friday_dua' and settings['friday_dua']:
            dua = random.choice(FRIDAY_DUAS)
            bot.send_message(chat_id, dua, parse_mode='Markdown')
            
    except Exception as e:
        print(f"خطأ في إرسال الأذكار: {e}")

def send_random_content(chat_id):
    """إرسال محتوى عشوائي (دعاء، آية، حديث)"""
    try:
        settings = get_chat_settings(chat_id)
        if not settings['random_content']:
            return
            
        content_type = random.choice(['dua', 'quran', 'hadith'])
        
        if content_type == 'dua':
            message = random.choice(RANDOM_DUAS)
        elif content_type == 'quran':
            message = random.choice(QURAN_VERSES)
        else:
            message = random.choice(HADITH_TEXTS)
            
        bot.send_message(chat_id, message, parse_mode='Markdown')
    except Exception as e:
        print(f"خطأ في إرسال المحتوى العشوائي: {e}")

def get_all_active_chats():
    """الحصول على جميع المجموعات النشطة"""
    cursor.execute('SELECT chat_id FROM chat_settings WHERE is_admin = 1')
    return [row[0] for row in cursor.fetchall()]

# إعداد المجدول (Scheduler)
scheduler = BackgroundScheduler(timezone=TIMEZONE)

def schedule_azkar_jobs():
    """جدولة جميع المهام"""
    # مسح المهام القديمة
    scheduler.remove_all_jobs()
    
    chats = get_all_active_chats()
    
    for chat_id in chats:
        settings = get_chat_settings(chat_id)
        
        try:
            # أذكار الصباح
            if settings['morning_azkar']:
                hour, minute = settings['morning_time'].split(':')
                scheduler.add_job(
                    send_azkar,
                    CronTrigger(hour=int(hour), minute=int(minute)),
                    args=[chat_id, 'morning'],
                    id=f'morning_{chat_id}'
                )
            
            # أذكار المساء
            if settings['evening_azkar']:
                hour, minute = settings['evening_time'].split(':')
                scheduler.add_job(
                    send_azkar,
                    CronTrigger(hour=int(hour), minute=int(minute)),
                    args=[chat_id, 'evening'],
                    id=f'evening_{chat_id}'
                )
            
            # رسالة قبل النوم
            if settings['sleep_image']:
                hour, minute = settings['sleep_time'].split(':')
                scheduler.add_job(
                    send_azkar,
                    CronTrigger(hour=int(hour), minute=int(minute)),
                    args=[chat_id, 'sleep'],
                    id=f'sleep_{chat_id}'
                )
            
            # سورة الكهف (الجمعة 9 صباحاً)
            if settings['friday_sura']:
                scheduler.add_job(
                    send_azkar,
                    CronTrigger(day_of_week='fri', hour=9, minute=0),
                    args=[chat_id, 'friday_kahf'],
                    id=f'kahf_{chat_id}'
                )
            
            # أدعية الجمعة (الساعة 10 صباحاً يوم الجمعة)
            if settings['friday_dua']:
                scheduler.add_job(
                    send_azkar,
                    CronTrigger(day_of_week='fri', hour=10, minute=0),
                    args=[chat_id, 'friday_dua'],
                    id=f'friday_dua_{chat_id}'
                )
            
            # محتوى عشوائي
            if settings['random_content'] and settings['content_interval'] > 0:
                scheduler.add_job(
                    send_random_content,
                    'interval',
                    minutes=settings['content_interval'],
                    args=[chat_id],
                    id=f'random_{chat_id}'
                )
        except (ValueError, KeyError) as e:
            print(f"خطأ في جدولة المهام للمجموعة {chat_id}: {e}")

# معالجات الأوامر
@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    """رسالة الترحيب"""
    # التحقق إذا كانت رسالة خاصة أو في مجموعة
    if message.chat.type == 'private':
        # رسالة خاصة - عرض معلومات البوت مع أزرار المطور والمجموعة
        markup = telebot.types.InlineKeyboardMarkup(row_width=1)
        markup.add(
            telebot.types.InlineKeyboardButton(
                "👨‍💻 المطور",
                url="https://t.me/dev3bod"
            ),
            telebot.types.InlineKeyboardButton(
                "👥 المجموعة الرسمية",
                url="https://t.me/NourAdhkar"
            )
        )
        
        welcome_text = """🌟 مرحباً بك في بوت الأذكار الإسلامية 🌟

هذا البوت يرسل الأذكار والأدعية تلقائياً في المجموعات:

📿 الميزات:
• أذكار الصباح والمساء
• سورة الكهف (الجمعة 9 صباحاً)
• أدعية الجمعة
• رسالة قبل النوم
• أكثر من 100 دعاء وآية وحديث
• محتوى خاص برمضان وعرفة والعيد

💡 للاستخدام:
1. أضف البوت إلى مجموعتك
2. اجعله مشرفاً
3. سيعمل تلقائياً!

⚙️ المشرفون يمكنهم استخدام:
/settings - لوحة التحكم
/status - حالة البوت

🤲 نسأل الله أن ينفع بهذا البوت"""
        
        bot.send_message(message.chat.id, welcome_text, reply_markup=markup)
        
    elif message.chat.type in ['group', 'supergroup']:
        # رسالة في مجموعة
        if is_user_admin(message.chat.id, message.from_user.id):
            # إذا كان المستخدم مشرف، عرض لوحة التحكم في الخاص
            try:
                markup = telebot.types.InlineKeyboardMarkup(row_width=1)
                markup.add(
                    telebot.types.InlineKeyboardButton(
                        "⚙️ لوحة التحكم",
                        url=f"https://t.me/{bot.get_me().username}?start=settings_{message.chat.id}"
                    )
                )
                
                bot.reply_to(
                    message, 
                    "👋 مرحباً! أنت مشرف في هذه المجموعة.\n\n"
                    "اضغط على الزر أدناه للوصول إلى لوحة التحكم في الخاص:",
                    reply_markup=markup
                )
            except:
                bot.reply_to(
                    message,
                    "👋 مرحباً! أنت مشرف في هذه المجموعة.\n\n"
                    "استخدم /settings لعرض لوحة التحكم."
                )
        else:
            # مستخدم عادي
            welcome_text = """🌟 مرحباً بك في بوت الأذكار الإسلامية 🌟

البوت يعمل تلقائياً ويرسل:
📿 أذكار الصباح والمساء
📖 آيات قرآنية وأحاديث نبوية
🕌 سورة الكهف يوم الجمعة
🤲 أدعية متنوعة

استخدم /help لمزيد من المعلومات"""
            bot.reply_to(message, welcome_text)

@bot.message_handler(commands=['enable'])
def enable_bot(message):
    """تفعيل البوت في المجموعة (في حال كان معطلاً)"""
    if message.chat.type not in ['group', 'supergroup']:
        bot.reply_to(message, "❌ هذا الأمر يعمل فقط في المجموعات")
        return
    
    if not is_user_admin(message.chat.id, message.from_user.id):
        bot.reply_to(message, "❌ هذا الأمر للمشرفين فقط")
        return
    
    # التحقق من أن البوت مشرف
    try:
        member = bot.get_chat_member(message.chat.id, bot.get_me().id)
        if member.status != 'administrator':
            bot.reply_to(message, "❌ يجب أن أكون مشرفاً في المجموعة لكي أعمل")
            return
    except:
        bot.reply_to(message, "❌ حدث خطأ في التحقق من صلاحياتي")
        return
    
    cursor.execute('UPDATE chat_settings SET is_admin = 1 WHERE chat_id = ?', (message.chat.id,))
    conn.commit()
    
    # إعادة جدولة المهام
    schedule_azkar_jobs()
    
    bot.reply_to(message, "✅ تم تفعيل البوت بنجاح!\n\n📿 سيتم إرسال الأذكار حسب الجدول المحدد.\n\nاستخدم /settings لتخصيص الإعدادات.")

@bot.message_handler(commands=['disable'])
def disable_bot(message):
    """تعطيل البوت في المجموعة"""
    if message.chat.type not in ['group', 'supergroup']:
        bot.reply_to(message, "❌ هذا الأمر يعمل فقط في المجموعات")
        return
    
    if not is_user_admin(message.chat.id, message.from_user.id):
        bot.reply_to(message, "❌ هذا الأمر للمشرفين فقط")
        return
    
    cursor.execute('UPDATE chat_settings SET is_admin = 0 WHERE chat_id = ?', (message.chat.id,))
    conn.commit()
    
    # إعادة جدولة المهام
    schedule_azkar_jobs()
    
    bot.reply_to(message, "✅ تم تعطيل البوت")

@bot.message_handler(commands=['status'])
def show_status(message):
    """عرض حالة البوت"""
    settings = get_chat_settings(message.chat.id)
    
    status = f"""📊 حالة البوت في هذه المجموعة:

🔰 الحالة: {'مفعّل ✅' if settings['is_admin'] else 'معطّل ❌'}

⏰ الإعدادات:
• أذكار الصباح ({settings['morning_time']}): {'✅' if settings['morning_azkar'] else '❌'}
• أذكار المساء ({settings['evening_time']}): {'✅' if settings['evening_azkar'] else '❌'}
• سورة الكهف: {'✅' if settings['friday_sura'] else '❌'}
• أدعية الجمعة: {'✅' if settings['friday_dua'] else '❌'}
• رسالة النوم ({settings['sleep_time']}): {'✅' if settings['sleep_image'] else '❌'}
• محتوى عشوائي: {'✅' if settings['random_content'] else '❌'}

⏱️ الفاصل الزمني: {settings['content_interval']} دقيقة

استخدم /settings لتغيير الإعدادات"""
    
    bot.reply_to(message, status)

def create_settings_markup(chat_id):
    """إنشاء لوحة الإعدادات"""
    markup = telebot.types.InlineKeyboardMarkup(row_width=2)
    settings = get_chat_settings(chat_id)
    
    # أزرار تفعيل/تعطيل الميزات
    markup.add(
        telebot.types.InlineKeyboardButton(
            f"{'✅' if settings['morning_azkar'] else '❌'} أذكار الصباح",
            callback_data='toggle_morning'
        ),
        telebot.types.InlineKeyboardButton(
            f"{'✅' if settings['evening_azkar'] else '❌'} أذكار المساء",
            callback_data='toggle_evening'
        )
    )
    
    markup.add(
        telebot.types.InlineKeyboardButton(
            f"{'✅' if settings['friday_sura'] else '❌'} سورة الكهف",
            callback_data='toggle_kahf'
        ),
        telebot.types.InlineKeyboardButton(
            f"{'✅' if settings['friday_dua'] else '❌'} أدعية الجمعة",
            callback_data='toggle_friday_dua'
        )
    )
    
    markup.add(
        telebot.types.InlineKeyboardButton(
            f"{'✅' if settings['sleep_image'] else '❌'} رسالة النوم",
            callback_data='toggle_sleep'
        ),
        telebot.types.InlineKeyboardButton(
            f"{'✅' if settings['random_content'] else '❌'} محتوى عشوائي",
            callback_data='toggle_random'
        )
    )
    
    markup.add(
        telebot.types.InlineKeyboardButton(
            "⏱️ تعديل الأوقات",
            callback_data='edit_times'
        ),
        telebot.types.InlineKeyboardButton(
            "⏲️ فاصل المحتوى",
            callback_data='edit_interval'
        )
    )
    
    markup.add(
        telebot.types.InlineKeyboardButton(
            "🔄 حفظ وإعادة تحميل",
            callback_data='reload_schedule'
        )
    )
    
    return markup

@bot.message_handler(commands=['settings'])
def show_settings(message):
    """عرض لوحة التحكم"""
    if message.chat.type not in ['group', 'supergroup']:
        bot.reply_to(message, "❌ هذا الأمر يعمل فقط في المجموعات")
        return
    
    if not is_user_admin(message.chat.id, message.from_user.id):
        bot.reply_to(message, "❌ هذا الأمر للمشرفين فقط")
        return
    
    markup = create_settings_markup(message.chat.id)
    
    bot.send_message(
        message.chat.id,
        "⚙️ لوحة التحكم\n\nاضغط على الأزرار لتفعيل أو تعطيل الميزات:",
        reply_markup=markup
    )

@bot.callback_query_handler(func=lambda call: True)
def callback_handler(call):
    """معالج الأزرار"""
    if not is_user_admin(call.message.chat.id, call.from_user.id):
        bot.answer_callback_query(call.id, "❌ هذا الأمر للمشرفين فقط")
        return
    
    chat_id = call.message.chat.id
    
    # تبديل الميزات
    toggles = {
        'toggle_morning': 'morning_azkar',
        'toggle_evening': 'evening_azkar',
        'toggle_kahf': 'friday_sura',
        'toggle_friday_dua': 'friday_dua',
        'toggle_sleep': 'sleep_image',
        'toggle_random': 'random_content'
    }
    
    if call.data in toggles:
        field = toggles[call.data]
        # استخدام parameterized query بشكل آمن
        query = f'UPDATE chat_settings SET {field} = 1 - {field} WHERE chat_id = ?'
        cursor.execute(query, (chat_id,))
        conn.commit()
        bot.answer_callback_query(call.id, "✅ تم التحديث")
        
        # تحديث الأزرار
        markup = create_settings_markup(chat_id)
        bot.edit_message_reply_markup(chat_id, call.message.message_id, reply_markup=markup)
        
    elif call.data == 'reload_schedule':
        schedule_azkar_jobs()
        bot.answer_callback_query(call.id, "✅ تم إعادة تحميل الجدول")
        
    elif call.data == 'edit_times':
        bot.answer_callback_query(call.id, "استخدم الأمر: /settime <نوع> <الوقت>\nمثال: /settime morning 06:00")
        
    elif call.data == 'edit_interval':
        bot.answer_callback_query(call.id, "استخدم الأمر: /setinterval <دقائق>\nمثال: /setinterval 120")

@bot.message_handler(commands=['settime'])
def set_time(message):
    """تعديل أوقات الأذكار"""
    if message.chat.type not in ['group', 'supergroup']:
        bot.reply_to(message, "❌ هذا الأمر يعمل فقط في المجموعات")
        return
    
    if not is_user_admin(message.chat.id, message.from_user.id):
        bot.reply_to(message, "❌ هذا الأمر للمشرفين فقط")
        return
    
    try:
        parts = message.text.split()
        if len(parts) != 3:
            raise ValueError("عدد المعاملات غير صحيح")
        
        time_type = parts[1]
        time_value = parts[2]
        
        # التحقق من صحة الوقت
        try:
            datetime.strptime(time_value, '%H:%M')
        except ValueError:
            raise ValueError("صيغة الوقت غير صحيحة. استخدم HH:MM")
        
        # قائمة بيضاء للأنواع المسموحة
        valid_types = {
            'morning': 'morning_time',
            'evening': 'evening_time',
            'sleep': 'sleep_time'
        }
        
        if time_type not in valid_types:
            raise ValueError("نوع غير صحيح. استخدم: morning, evening, sleep")
        
        field = valid_types[time_type]
        cursor.execute(f'UPDATE chat_settings SET {field} = ? WHERE chat_id = ?', (time_value, message.chat.id))
        conn.commit()
        
        schedule_azkar_jobs()
        
        bot.reply_to(message, f"✅ تم تحديث وقت {time_type} إلى {time_value}")
        
    except ValueError as e:
        bot.reply_to(message, f"❌ {str(e)}\n\nالاستخدام: /settime <morning/evening/sleep> <HH:MM>\nمثال: /settime morning 06:00")
    except Exception as e:
        print(f"خطأ في settime: {e}")
        bot.reply_to(message, "❌ حدث خطأ أثناء تحديث الوقت")

@bot.message_handler(commands=['setinterval'])
def set_interval(message):
    """تعديل الفاصل الزمني للمحتوى العشوائي"""
    if message.chat.type not in ['group', 'supergroup']:
        bot.reply_to(message, "❌ هذا الأمر يعمل فقط في المجموعات")
        return
    
    if not is_user_admin(message.chat.id, message.from_user.id):
        bot.reply_to(message, "❌ هذا الأمر للمشرفين فقط")
        return
    
    try:
        parts = message.text.split()
        if len(parts) != 2:
            raise ValueError()
        
        interval = int(parts[1])
        if interval < 0:
            raise ValueError()
        
        cursor.execute('UPDATE chat_settings SET content_interval = ? WHERE chat_id = ?', (interval, message.chat.id))
        conn.commit()
        
        schedule_azkar_jobs()
        
        bot.reply_to(message, f"✅ تم تحديث الفاصل الزمني إلى {interval} دقيقة")
        
    except:
        bot.reply_to(message, "❌ صيغة خاطئة\n\nالاستخدام: /setinterval <دقائق>\nمثال: /setinterval 120")

# معالج للكشف عن إضافة البوت كمشرف
@bot.message_handler(content_types=['new_chat_members'])
def new_member(message):
    """عند إضافة البوت إلى مجموعة"""
    for new_member in message.new_chat_members:
        if new_member.id == bot.get_me().id:
            # البوت تمت إضافته - التحقق من أنه مشرف وتفعيله تلقائياً
            try:
                member = bot.get_chat_member(message.chat.id, bot.get_me().id)
                if member.status in ['administrator']:
                    # البوت مشرف - تفعيله تلقائياً
                    cursor.execute('UPDATE chat_settings SET is_admin = 1 WHERE chat_id = ?', (message.chat.id,))
                    conn.commit()
                    schedule_azkar_jobs()
                    
                    welcome = """🌟 شكراً لإضافتي إلى المجموعة! 🌟

تم تفعيل البوت تلقائياً! ✅

سأرسل لكم:
📿 أذكار الصباح (5:00 ص) والمساء (6:00 م)
📖 آيات قرآنية وأحاديث نبوية متنوعة
🕌 سورة الكهف يوم الجمعة (9:00 ص)
🤲 أدعية الجمعة (10:00 ص)
😴 رسالة قبل النوم (10:00 م)

⚙️ المشرفون يمكنهم استخدام:
/settings - لوحة التحكم الكاملة
/status - عرض حالة البوت
/disable - تعطيل البوت مؤقتاً

🤲 بارك الله فيكم وجعل هذا البوت في ميزان حسناتكم"""
                else:
                    # البوت ليس مشرف
                    welcome = """🌟 شكراً لإضافتي إلى المجموعة! 🌟

⚠️ لكي أعمل بشكل صحيح، يجب أن أكون مشرفاً في المجموعة.

بعد جعلي مشرفاً، سأعمل تلقائياً وأرسل:
📿 أذكار الصباح والمساء
📖 آيات قرآنية وأحاديث نبوية
🕌 سورة الكهف يوم الجمعة
🤲 أدعية متنوعة

💡 بمجرد جعلي مشرفاً، سأبدأ العمل فوراً!

🤲 بارك الله فيكم"""
                    
            except:
                welcome = """🌟 شكراً لإضافتي إلى المجموعة! 🌟

أنا بوت الأذكار الإسلامية، سأرسل لكم:
📿 أذكار الصباح والمساء
📖 آيات قرآنية وأحاديث نبوية
🕌 سورة الكهف يوم الجمعة
🤲 أدعية متنوعة

💡 للبدء، اجعلني مشرفاً في المجموعة وسأعمل تلقائياً!

للمساعدة، استخدم /help

🤲 بارك الله فيكم"""
                
            bot.send_message(message.chat.id, welcome)

# معالج لتحديث حالة البوت عند ترقيته لمشرف
@bot.message_handler(content_types=['my_chat_member'])
def chat_member_updated(message):
    """عند تغيير حالة البوت في المجموعة"""
    try:
        new_status = message.new_chat_member.status
        old_status = message.old_chat_member.status
        
        # إذا تمت ترقية البوت لمشرف
        if new_status == 'administrator' and old_status != 'administrator':
            cursor.execute('UPDATE chat_settings SET is_admin = 1 WHERE chat_id = ?', (message.chat.id,))
            conn.commit()
            schedule_azkar_jobs()
            
            bot.send_message(
                message.chat.id,
                "✅ تم تفعيل البوت تلقائياً!\n\n"
                "سأبدأ بإرسال الأذكار والأدعية حسب الجدول المحدد.\n\n"
                "استخدم /settings لتخصيص الإعدادات."
            )
        # إذا تم إلغاء صلاحيات البوت
        elif old_status == 'administrator' and new_status != 'administrator':
            cursor.execute('UPDATE chat_settings SET is_admin = 0 WHERE chat_id = ?', (message.chat.id,))
            conn.commit()
            schedule_azkar_jobs()
            
            bot.send_message(
                message.chat.id,
                "⚠️ تم تعطيل البوت لأنني لم أعد مشرفاً.\n\n"
                "لإعادة التفعيل، اجعلني مشرفاً مرة أخرى."
            )
    except Exception as e:
        print(f"خطأ في chat_member_updated: {e}")

# Flask routes for webhook
@app.route('/' + BOT_TOKEN, methods=['POST'])
def webhook():
    """معالج Webhook"""
    if request.headers.get('content-type') == 'application/json':
        json_string = request.get_data().decode('utf-8')
        update = telebot.types.Update.de_json(json_string)
        bot.process_new_updates([update])
        return '', 200
    else:
        abort(403)

@app.route('/')
def index():
    """الصفحة الرئيسية"""
    return """
    <html dir="rtl">
    <head>
        <meta charset="utf-8">
        <title>بوت الأذكار الإسلامية</title>
        <style>
            body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
            h1 { color: #2c3e50; }
            .status { color: #27ae60; font-size: 20px; }
        </style>
    </head>
    <body>
        <h1>🌟 بوت الأذكار الإسلامية 🌟</h1>
        <p class="status">✅ البوت يعمل بنجاح</p>
        <p>📿 يرسل الأذكار والأدعية تلقائياً</p>
        <p>🕌 سورة الكهف يوم الجمعة</p>
        <p>🤲 أدعية وآيات متنوعة</p>
    </body>
    </html>
    """, 200

@app.route('/setwebhook')
def set_webhook_route():
    """تعيين Webhook يدوياً"""
    try:
        webhook_url = request.args.get('url')
        if not webhook_url:
            return "❌ يرجى تحديد URL\n\nمثال: /setwebhook?url=https://your-app.vercel.app", 400
        
        bot.remove_webhook()
        time.sleep(1)
        bot.set_webhook(url=webhook_url + '/' + BOT_TOKEN)
        return f"✅ تم تعيين Webhook بنجاح:\n{webhook_url}/{BOT_TOKEN}", 200
    except Exception as e:
        return f"❌ خطأ: {str(e)}", 500

@app.route('/removewebhook')
def remove_webhook_route():
    """إزالة Webhook"""
    try:
        bot.remove_webhook()
        return "✅ تم إزالة Webhook", 200
    except Exception as e:
        return f"❌ خطأ: {str(e)}", 500

@app.route('/webhookinfo')
def webhook_info():
    """معلومات Webhook"""
    try:
        info = bot.get_webhook_info()
        return f"""
        📊 معلومات Webhook:
        
        URL: {info.url or 'غير معيّن'}
        Pending: {info.pending_update_count}
        Last Error: {info.last_error_date or 'لا يوجد'}
        Error Message: {info.last_error_message or 'لا يوجد'}
        Max Connections: {info.max_connections}
        """, 200
    except Exception as e:
        return f"❌ خطأ: {str(e)}", 500

def run_polling():
    """تشغيل البوت بوضع Long Polling"""
    print("🚀 بدء تشغيل البوت بوضع Long Polling...")
    
    # إزالة webhook إن وجد
    bot.remove_webhook()
    time.sleep(1)
    
    # بدء المجدول
    if not scheduler.running:
        scheduler.start()
    
    # جدولة المهام الأولية
    schedule_azkar_jobs()
    
    print("✅ البوت جاهز ويعمل!")
    print("📿 سيتم إرسال الأذكار حسب الجدول المحدد")
    
    # بدء استقبال الرسائل
    bot.infinity_polling(timeout=10, long_polling_timeout=5)

def run_webhook():
    """تشغيل البوت بوضع Webhook"""
    print("🚀 بدء تشغيل البوت بوضع Webhook...")
    
    # بدء المجدول
    if not scheduler.running:
        scheduler.start()
    
    # جدولة المهام الأولية
    schedule_azkar_jobs()
    
    print("✅ البوت جاهز!")
    print("📝 تذكير: قم بتعيين Webhook باستخدام /setwebhook?url=YOUR_URL")

if __name__ == '__main__':
    # التحقق من وضع التشغيل
    mode = os.environ.get('BOT_MODE', 'polling').lower()
    
    if mode == 'webhook':
        # وضع Webhook (للإنتاج)
        run_webhook()
        app.run(host='0.0.0.0', port=int(os.environ.get('PORT', 5000)))
    else:
        # وضع Long Polling (للتطوير والاختبار)
        run_polling()
