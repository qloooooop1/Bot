# دليل الاختبار السريع - بوت الأذكار الإسلامية

## اختبار البوت محلياً

### 1. اختبار وضع Long Polling

```bash
# تعيين متغير البيئة (اختياري)
export BOT_TOKEN="YOUR_BOT_TOKEN"

# تشغيل البوت
python App.py
```

البوت سيعمل في وضع polling ويستقبل الرسائل مباشرة.

### 2. اختبار وضع Webhook

```bash
# تعيين المتغيرات
export BOT_MODE=webhook
export BOT_TOKEN="YOUR_BOT_TOKEN"
export PORT=5000

# تشغيل البوت
python App.py
```

ثم في متصفح آخر أو باستخدام curl:

```bash
# تعيين webhook
curl "http://localhost:5000/setwebhook?url=https://your-domain.com"

# التحقق من webhook
curl "http://localhost:5000/webhookinfo"

# إزالة webhook
curl "http://localhost:5000/removewebhook"
```

## سيناريوهات الاختبار

### 1. إضافة البوت إلى مجموعة جديدة

1. أضف البوت إلى مجموعة تجريبية
2. اجعله مشرفاً
3. يجب أن يرسل رسالة ترحيب تلقائياً

### 2. تفعيل البوت

في المجموعة، أرسل:
```
/enable
```

يجب أن يؤكد البوت التفعيل.

### 3. عرض الحالة

```
/status
```

يجب أن يعرض الإعدادات الحالية.

### 4. لوحة التحكم

```
/settings
```

يجب أن تظهر أزرار تفاعلية للتحكم في الميزات.

### 5. تخصيص الأوقات

```
/settime morning 06:30
/settime evening 19:00
/settime sleep 22:30
```

### 6. تخصيص الفاصل الزمني

```
/setinterval 60
```

لإرسال محتوى عشوائي كل 60 دقيقة.

## الأوامر المتاحة للاختبار

### للجميع:
- `/start` - رسالة الترحيب
- `/help` - المساعدة

### للمشرفين:
- `/enable` - تفعيل البوت
- `/disable` - تعطيل البوت
- `/status` - عرض الحالة
- `/settings` - لوحة التحكم
- `/settime <type> <HH:MM>` - تعديل الأوقات
- `/setinterval <minutes>` - تعديل الفاصل الزمني

## التحقق من الجدولة

لاختبار أن الجدولة تعمل بشكل صحيح:

```python
# في Python shell
import App

# جدولة المهام
App.schedule_azkar_jobs()

# عرض المهام المجدولة
for job in App.scheduler.get_jobs():
    print(f"Job: {job.id}, Next run: {job.next_run_time}")
```

## تنظيف قاعدة البيانات للاختبار

```bash
# حذف قاعدة البيانات القديمة
rm azkar_bot.db

# إعادة تشغيل البوت
python App.py
```

سيتم إنشاء قاعدة بيانات جديدة بإعدادات افتراضية.

## ملاحظات مهمة

1. **التوكن**: تأكد من استخدام توكن صحيح من @BotFather
2. **الصلاحيات**: البوت يحتاج أن يكون مشرفاً في المجموعة
3. **التوقيت**: التوقيت الافتراضي هو Asia/Riyadh
4. **الاختبار المحلي**: استخدم polling للاختبار المحلي
5. **الإنتاج**: استخدم webhook للنشر على خوادم الإنتاج

## استكشاف الأخطاء

### البوت لا يستجيب:
- تأكد من التوكن صحيح
- تأكد من البوت مشرف في المجموعة
- تأكد من تفعيل البوت بأمر /enable

### المهام المجدولة لا تعمل:
- تأكد من تشغيل scheduler
- تحقق من الأوقات المحددة
- تأكد من تفعيل الميزات في الإعدادات

### أخطاء قاعدة البيانات:
- احذف ملف azkar_bot.db
- أعد تشغيل البوت

## مثال على جلسة اختبار كاملة

```bash
# 1. تثبيت المتطلبات
pip install -r requirements.txt

# 2. تشغيل البوت
python App.py

# 3. في تيليجرام:
# - أضف البوت إلى مجموعة
# - اجعله مشرفاً
# - أرسل /enable
# - أرسل /settings
# - جرب تفعيل/تعطيل الميزات
# - أرسل /status للتحقق

# 4. اختبار الأوامر المتقدمة:
/settime morning 06:00
/setinterval 120
/status

# 5. التحقق من أن كل شيء يعمل!
```
